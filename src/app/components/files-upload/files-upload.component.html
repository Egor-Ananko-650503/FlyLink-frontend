<ngfFormData
  [(FormData)]="formData"
  [files]="validFiles"
  postName="files"
></ngfFormData>

<ngfUploadStatus
  [(percent)]="progress"
  [httpEvent]="httpEvent"
></ngfUploadStatus>

<div class="inline-block">
  <div ngfDrop
       [(files)]="validFiles"
       [(file)]="lastUploadedFile"
       [(lastInvalids)]="lastInvalids"
       [(validDrag)]="validDrag"
       [(invalidDrag)]="invalidDrag"
       [accept]="accept"
       [ngClass]="{'myHoverClass': validDrag, 'myAntiHoverClass': validDrag}"
       class="drop-zone"
       [class.invalid-drag]="validDrag === false"
       [class.valid-drag]="validDrag"
  >
    <div class="drop-zone-text-wrapper">
      <div class="drop-zone-text">Drop files here</div>
    </div>
  </div>
  <div class="input-filter-block">
    <mat-form-field class="input-filter-form-field">
      <input matInput type="text" placeholder="Type filter" [(ngModel)]="accept">
    </mat-form-field>
  </div>
</div>

<div class="bg-warning" *ngIf="lastInvalids?.length" style="margin-bottom: 40px">
  <h3 style="color:red;">Last {{ lastInvalids.length }} Invalid Selected Files</h3>

  <table class="table">
    <thead>
    <tr>
      <th>Name</th>
      <th>Error</th>
      <th>Type</th>
      <th>Size</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let item of lastInvalids;let i=index">
      <td>
        <div *ngIf="['image/gif','image/png','image/jpeg'].indexOf(item.file.type)>=0">
          <div class="previewIcon" [ngfBackground]="item.file"></div>
        </div>
        <strong>{{ item.file.name }}</strong>
      </td>
      <td nowrap>
        {{ item.errorType }}
      </td>
      <td nowrap>
        {{ item.file.type }}
      </td>
      <td nowrap>
        {{ item.file.size / 1024 / 1024 | number:'.2' }} MB
      </td>
      <td nowrap>
        <button type="button"
                class="btn btn-danger btn-xs"
                (click)="lastInvalids.splice(i,1)"
        >
          <span class="glyphicon glyphicon-trash"></span>
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<div class="table-container">
  <h3>{{ validFiles.length }} Queued Files</h3>
  <div *ngIf="validFiles.length != 0" class="valid-table-block">
    <table mat-table [dataSource]="validFiles" class="valid-table">
      <ng-container matColumnDef="position">
        <th mat-header-cell *matHeaderCellDef>No.</th>
        <td mat-cell *matCellDef="let element">{{validFiles.indexOf(element) + 1}}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let element">
          <strong>{{element.name}}</strong>
        </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let element">{{element.type}}</td>
      </ng-container>

      <ng-container matColumnDef="size">
        <th mat-header-cell *matHeaderCellDef>Size</th>
        <td mat-cell *matCellDef="let element">{{element.size / 1024 / 1024 | number:'.3'}} MB</td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>Action</th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button (click)="uploadFile(element)">
            <mat-icon>save</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteItem(validFiles.indexOf(element))">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <div class="buttons-group">
      <button mat-raised-button color="primary" class="button-delete-all" (click)="deleteAllItems()">Delete all</button>
      <button mat-raised-button color="primary" class="button-upload-all" (click)="uploadAll()">Upload all</button>
    </div>
  </div>
  <!--<span style="font-weight:bold;color:green;" *ngIf="messageMultiple.length">-->
  <!--<div *ngFor="let item of messageMultiple">-->
  <!--{{item.fileDownloadUri}}-->
  <!--</div>-->
  <!--</span>-->
</div>

